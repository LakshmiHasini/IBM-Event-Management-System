<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - EventTribe</title>
    <link rel="stylesheet" href="./src/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
</head>

<body>
    <main class="card-container">
        <div class="login-card">
            <h1 id="logo"><span>event</span><span class="bi bi-lightning-charge-fill"
                    style="font-size: 18px"></span><span>tribe</span></h1>
            <h1>Sign Up</h1>
            <form id="register-form" onsubmit="handleSignup(event)">
                <div class="form-group">
                    <input type="text" id="full-name" placeholder="Full Name" required minlength="2" maxlength="50">
                    <span class="error-message" id="name-error"></span>
                    <small class="field-hint">Name must be between 2-50 characters</small>
                </div>
                <div class="form-group">
                    <input type="email" id="email" placeholder="Email" required minlength="5" maxlength="100"
                        pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$"
                        title="Please enter a valid email address (e.g. user@example.com)">
                    <span class="error-message" id="email-error"></span>
                    <small class="field-hint">Email must be between 5-100 characters</small>
                </div>
                <div class="form-group">
                    <input type="password" id="password" placeholder="Password" required minlength="8" maxlength="50"
                        pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}"
                        title="Must contain at least one number, one uppercase, one lowercase letter, and be at least 8 characters long">
                    <span class="error-message" id="password-error"></span>
                    <small class="field-hint">Password must be 8-50 characters with at least one letter and one
                        number</small>
                </div>
                <div class="form-group">
                    <input type="password" id="confirm-password" placeholder="Confirm Password" required minlength="8"
                        maxlength="50">
                    <span class="error-message" id="confirm-error"></span>
                    <small class="field-hint">Re-enter your password to confirm</small>
                </div>
                <button type="submit" class="btn btn-primary">Sign Up</button>
            </form>
            <div class="signIn-other">
                <span>Or Sign Up with</span>
                <br>
                <p>By clicking Sign Up or the Apple, Google, or Facebook icons, you agree to EventTribe's <a
                        href="./help.html">Terms of Service</a> and <a href="./help.html">Privacy Policy</a>.</p>
                <div>
                    <span class="bi bi-google"></span>
                    <span class="bi bi-facebook"></span>
                    <span class="bi bi-apple"></span>
                </div>
                <a href="./login.html">Already have an account? Log In</a>
            </div>
        </div>
    </main>

    <script>
        // Validation constraints
        const NAME_MIN_LENGTH = 2;
        const NAME_MAX_LENGTH = 50;
        const EMAIL_MIN_LENGTH = 5;
        const EMAIL_MAX_LENGTH = 100;
        const PASSWORD_MIN_LENGTH = 8;
        const PASSWORD_MAX_LENGTH = 50;

        function validateName(name) {
            name = name.trim();

            if (name.length < NAME_MIN_LENGTH) {
                return { valid: false, message: `Name must be at least ${NAME_MIN_LENGTH} characters long` };
            }

            if (name.length > NAME_MAX_LENGTH) {
                return { valid: false, message: `Name must not exceed ${NAME_MAX_LENGTH} characters` };
            }

            // Check for valid name format (letters, spaces, hyphens, apostrophes)
            const nameRegex = /^[a-zA-Z\s'-]+$/;
            if (!nameRegex.test(name)) {
                return { valid: false, message: 'Name can only contain letters, spaces, hyphens, and apostrophes' };
            }

            return { valid: true };
        }

        function validateEmail(email) {
            email = email.trim();

            if (email.length < EMAIL_MIN_LENGTH) {
                return { valid: false, message: `Email must be at least ${EMAIL_MIN_LENGTH} characters long` };
            }

            if (email.length > EMAIL_MAX_LENGTH) {
                return { valid: false, message: `Email must not exceed ${EMAIL_MAX_LENGTH} characters` };
            }

            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                return { valid: false, message: 'Please enter a valid email address (e.g., user@example.com)' };
            }

            const parts = email.split('@');
            if (parts.length !== 2 || !parts[1].includes('.')) {
                return { valid: false, message: 'Email must have a valid domain (e.g., @example.com)' };
            }

            const domainParts = parts[1].split('.');
            if (domainParts.length < 2 || domainParts[domainParts.length - 1].length < 2) {
                return { valid: false, message: 'Email domain must have a valid extension (e.g., .com, .org)' };
            }

            return { valid: true };
        }

        function validatePassword(password) {
            if (password.length < PASSWORD_MIN_LENGTH) {
                return { valid: false, message: `Password must be at least ${PASSWORD_MIN_LENGTH} characters long` };
            }

            if (password.length > PASSWORD_MAX_LENGTH) {
                return { valid: false, message: `Password must not exceed ${PASSWORD_MAX_LENGTH} characters` };
            }

            const hasLetter = /[a-zA-Z]/.test(password);
            if (!hasLetter) {
                return { valid: false, message: 'Password must contain at least one letter' };
            }

            const hasNumber = /[0-9]/.test(password);
            if (!hasNumber) {
                return { valid: false, message: 'Password must contain at least one number' };
            }

            return { valid: true };
        }

        function handleSignup(event) {
            event.preventDefault();

            const fullName = document.getElementById('full-name').value.trim();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            const nameError = document.getElementById('name-error');
            const emailError = document.getElementById('email-error');
            const passwordError = document.getElementById('password-error');
            const confirmError = document.getElementById('confirm-error');

            let isValid = true;

            // Clear previous errors
            nameError.textContent = '';
            emailError.textContent = '';
            passwordError.textContent = '';
            confirmError.textContent = '';

            // Validate name
            const nameValidation = validateName(fullName);
            if (!nameValidation.valid) {
                nameError.textContent = nameValidation.message;
                nameError.style.color = '#e63946';
                isValid = false;
            }

            // Validate email
            const emailValidation = validateEmail(email);
            if (!emailValidation.valid) {
                emailError.textContent = emailValidation.message;
                emailError.style.color = '#e63946';
                isValid = false;
            }

            // Validate password
            const passwordValidation = validatePassword(password);
            if (!passwordValidation.valid) {
                passwordError.textContent = passwordValidation.message;
                passwordError.style.color = '#e63946';
                isValid = false;
            }

            // Validate password match
            if (password !== confirmPassword) {
                confirmError.textContent = 'Passwords do not match';
                confirmError.style.color = '#e63946';
                isValid = false;
            }

            if (isValid) {
                // Save user data
                localStorage.setItem('loggedIn', 'true');
                localStorage.setItem('userEmail', email);
                localStorage.setItem('userName', fullName);

                alert('Sign up successful! Welcome to EventTribe.');
                window.location.href = './index.html';
            }
        }

        // Real-time validation
        document.addEventListener('DOMContentLoaded', function () {
            const nameInput = document.getElementById('full-name');
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirm-password');

            const nameError = document.getElementById('name-error');
            const emailError = document.getElementById('email-error');
            const passwordError = document.getElementById('password-error');
            const confirmError = document.getElementById('confirm-error');

            // Name validation
            nameInput.addEventListener('blur', function () {
                const name = this.value.trim();
                if (name.length > 0) {
                    const validation = validateName(name);
                    if (!validation.valid) {
                        nameError.textContent = validation.message;
                        nameError.style.color = '#e63946';
                    } else {
                        nameError.textContent = '';
                    }
                }
            });

            // Email validation
            emailInput.addEventListener('blur', function () {
                const email = this.value.trim();
                if (email.length > 0) {
                    const validation = validateEmail(email);
                    if (!validation.valid) {
                        emailError.textContent = validation.message;
                        emailError.style.color = '#e63946';
                    } else {
                        emailError.textContent = '';
                    }
                }
            });

            // Password validation
            passwordInput.addEventListener('blur', function () {
                const password = this.value;
                if (password.length > 0) {
                    const validation = validatePassword(password);
                    if (!validation.valid) {
                        passwordError.textContent = validation.message;
                        passwordError.style.color = '#e63946';
                    } else {
                        passwordError.textContent = '';
                    }
                }

                // Also check password match if confirm password has value
                const confirmPassword = confirmPasswordInput.value;
                if (confirmPassword.length > 0) {
                    if (password !== confirmPassword) {
                        confirmError.textContent = 'Passwords do not match';
                        confirmError.style.color = '#e63946';
                    } else {
                        confirmError.textContent = '';
                    }
                }
            });

            // Confirm password validation
            confirmPasswordInput.addEventListener('blur', function () {
                const password = passwordInput.value;
                const confirmPassword = this.value;
                if (confirmPassword.length > 0) {
                    if (password !== confirmPassword) {
                        confirmError.textContent = 'Passwords do not match';
                        confirmError.style.color = '#e63946';
                    } else {
                        confirmError.textContent = '';
                    }
                }
            });

            // Clear errors on input
            nameInput.addEventListener('input', function () {
                if (nameError.textContent) {
                    nameError.textContent = '';
                }
            });

            emailInput.addEventListener('input', function () {
                if (emailError.textContent) {
                    emailError.textContent = '';
                }
            });

            passwordInput.addEventListener('input', function () {
                if (passwordError.textContent) {
                    passwordError.textContent = '';
                }
                // Clear confirm error when password changes
                if (confirmError.textContent && confirmPasswordInput.value.length > 0) {
                    const confirmPassword = confirmPasswordInput.value;
                    if (this.value === confirmPassword) {
                        confirmError.textContent = '';
                    }
                }
            });

            confirmPasswordInput.addEventListener('input', function () {
                if (confirmError.textContent) {
                    const password = passwordInput.value;
                    if (this.value === password) {
                        confirmError.textContent = '';
                    }
                }
            });
        });
    </script>
</body>

</html>